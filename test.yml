---
- name: Generate SSH key pair
  hosts: dev
  tasks:
    - name: generate SSH key
      openssh_keypair:
        path: "{{ ansible_env.HOME }}/.ssh/test_key_gen"
        type: ed25519
        state: present
        comment: "test key gen"
      register: public_key

    - name: Set authorized keys taken from url using lookup
      ansible.posix.authorized_key:
        user: pi
        state: present
        key: "{{ public_key.public_key }}"
        comment: "testy"

    - name: Tell the host about our servers it might want to ssh to
      ansible.builtin.known_hosts:
        name: dev
        hash_host: true
        key: "{{ public_key.public_key }}"

    - name: Display the captured return value
      debug:
        msg: "{{ public_key.public_key }}"
