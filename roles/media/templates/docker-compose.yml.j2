version: "3.7"

networks:
  media:
    name: media
    driver: macvlan
    driver_opts:
      parent: enp3s0
    ipam:
      config:
        - subnet: "10.0.0.0/24"
          gateway: "10.0.0.1"

services:

  gluetun:
    image: qmcgaw/gluetun:v3.40.3
    restart: on-failure
    container_name: {{gluetun_container_name}}
    cap_add:
      - NET_ADMIN
    ports:
        # QBT UI Port
        - 8080:8080
    environment:
      - VPN_SERVICE_PROVIDER=airvpn
      - SERVER_COUNTRIES=Switzerland
      - FIREWALL_VPN_INPUT_PORTS=9352
      - VPN_TYPE=wireguard
      - WIREGUARD_PRIVATE_KEY={{ WIREGUARD_PRIVATE_KEY }}
      - WIREGUARD_PRESHARED_KEY={{ WIREGUARD_PRE_SHARED_KEY }}
      - WIREGUARD_ADDRESSES={{ WIREGUARD_ADDRESS }}
    devices:
      - /dev/net/tun:/dev/net/tun
    volumes:
      - {{ docker_dir }}/{{gluetun_container_name}}/config:/gluetun
    networks:
      media:
        ipv4_address: 10.0.0.3

  prowlarr:
    image: lscr.io/linuxserver/prowlarr:2.3.0.5236-ls132
    user: "1000:1000"
    restart: on-failure
    container_name: {{prowlarr_container_name}}
    environment:
        - TZ=America/New_York
        - PROWLARR__PORT=9696
    volumes:
      - {{docker_dir}}/{{prowlarr_container_name}}/config:/config
    networks:
      media:
        ipv4_address: 10.0.0.14

  qbittorrent:
    container_name: {{qbt_container_name}}
    user: "1000:1000"
    restart: on-failure
    image: lscr.io/linuxserver/qbittorrent:5.1.2
    environment:
      - QBITTORRENT__PORT=8080
    volumes:
      - {{docker_dir}}/{{qbt_container_name}}/config:/config
      - {{torrent_downloads}}:/torrent-downloads
    network_mode: service:gluetun

  sonarr:
    container_name: {{sonarr_container_name}}
    image: lscr.io/linuxserver/sonarr:4.0.16.2944-ls298
    user: "1000:1000"
    restart: on-failure
    environment:
      - SONARR__PORT=8989
      - SONARR__APPLICATION_URL="https://sonarr.mchouseface.com/"
      - TZ=America/New_York
    volumes:
      - {{docker_dir}}/{{sonarr_container_name}}/config:/config
      - {{plex_tv_dir}}:/tv
      - {{torrent_downloads}}:/torrent-downloads
      - {{nzb_downloads}}:/nzb-downloads
    ports:
      - 8989:8989
    networks:
      media:
        ipv4_address: 10.0.0.11
  
  sabnzbd:
    container_name: {{sabnzbd_container_name}}
    image: lscr.io/linuxserver/sabnzbd:version-4.5.3
    user: "1000:1000"
    restart: on-failure
    environment:
      - SABNZBD__PORT=9090
    volumes:
      - {{docker_dir}}/{{sabnzbd_container_name}}/config:/config
      - {{nzb_downloads}}:/nzb-downloads
      - {{nzb_incomplete_downloads}}:/nzb-incomplete-downloads
      - {{sabnzbd_backup_dir}}:/backups
    networks:
      media:
        ipv4_address: 10.0.0.12

  radarr:
    container_name: {{radarr_container_name}}
    image: lscr.io/linuxserver/radarr:5.28.0.10274-ls286
    user: "1000:1000"
    restart: on-failure
    environment:
      - RADARR__PORT=7878
    volumes:
      - {{docker_dir}}/{{radarr_container_name}}/config:/config
      - {{plex_movies_dir}}:/movies
      - {{torrent_downloads}}:/torrent-downloads
      - {{nzb_downloads}}:/nzb-downloads
    networks:
      media:
        ipv4_address: 10.0.0.13

  plex:
    image: lscr.io/linuxserver/plex:1.42.2.10156-f737b826c-ls285
    container_name: media-plex
    restart: on-failure
    network_mode: host
    environment:
      - PUID=1000                 # Change this to your user ID
      - PGID=1000                 # Change this to your group ID
      - VERSION=docker
      - TZ=America/New_York
    volumes:
      - "{{ docker_dir }}/media-plex/config:/config"  # Change to the path where your Plex config will be stored
      - "{{ plex_tv_dir }}:/tv"     # Change to the path for your TV shows
      - "{{ plex_movies_dir }}:/movies"  # Change to the path for your movies
      - "{{ docker_dir }}/media-plex/transcode:/transcode"  # Change to the path for transcoding
      - "{{ plex_holiday_dir }}:/holiday-movies"
      - "{{ plex_kids_dir }}:/kids"
    devices:
      - /dev/dri:/dev/dri       # This allows Plex to access the Intel GPU for hardware encoding

  flaresolverr:
    image: flaresolverr/flaresolverr:v3.4.5
    container_name: flaresolverr
    restart: unless-stopped
    ports:
      - "8191:8191"
    networks:
      media:
        ipv4_address: 10.0.0.16